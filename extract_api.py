#/usr/bin/python
#coding=utf-8
import sys,os
import shutil
import zipfile 
from xml.dom import minidom

file_name = "1.apk"
file_dir = "apk/smali"
# file_dir = "uncompress"

#if apk folder exits then delete it
# if os.path.isdir(file_dir):
# 	shutil.rmtree(file_dir)

#unzip to get .dex
# zf = zipfile.ZipFile(file_name, 'r' )
# for f in zf.namelist():
# 	zf.extract(f,file_dir)

#get MainActivity name
AndroidManifest = minidom.parse("apk/AndroidManifest.xml")
MainActivity = ""
for activity in AndroidManifest.getElementsByTagName("activity"):
	activity_name = activity.attributes["android:name"].value
	if len(activity.getElementsByTagName("action")) > 0:
		for temp in activity.getElementsByTagName("action"):
			if temp.attributes["android:name"].value=="android.intent.action.MAIN":
				MainActivity = activity_name

#dex2jar
#tips need to chmod +x ./d2j_invoke.sh
# os.system("sh ./dex2jar/d2j-dex2jar.sh  uncompress/classes.dex")
# os.system("chmod 777 classes-dex2jar.jar")
# os.system("mv classes-dex2jar.jar ./jar/")

#extract api from smal
for file in os.listdir(file_dir):
	print(file)



