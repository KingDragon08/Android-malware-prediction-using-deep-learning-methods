.class public Lcom/nom/lib/service/YGNotificationService;
.super Landroid/app/Service;
.implements Lcom/nom/lib/ws/request/WSRequest$IWSRequestCallback;
.source "YGNotificationService.java"

.field public final static ACTION_LAUNCH:Ljava/lang/String; = "com.nom.lib.service.YGNotificationService.intent.action.Launch"

.field final static DEFAULT_POLLING_INTERVAL:J = 86400000L

.field final static FIRST_POLLING_INTERVAL:J = 10000L

.field public final static NID_AIR_INSTALLED:I = 9999

.field public final static NOTIFICATION_ID:Ljava/lang/String; = "NotificationId"

.field private mPollingInterval:J

.field private mTimerHandler:Landroid/os/Handler;

.field private mmgrNotification:Landroid/app/NotificationManager;

.field private mrequestNotifications:Lcom/nom/lib/ws/request/WSRequest;

.field private final pollNotificationTask:Ljava/lang/Runnable;

.method public constructor <init>()V
    .registers 3
    .prologue
    .line 24
    invoke-direct { p0 }, Landroid/app/Service;-><init>()V
    .line 219
    const-wide/32 v0, 86400000
    iput-wide v0, p0, Lcom/nom/lib/service/YGNotificationService;->mPollingInterval:J
    .line 222
    new-instance v0, Lcom/nom/lib/service/YGNotificationService$1;
    invoke-direct { v0, p0 }, Lcom/nom/lib/service/YGNotificationService$1;-><init>(Lcom/nom/lib/service/YGNotificationService;)V
    iput-object v0, p0, Lcom/nom/lib/service/YGNotificationService;->pollNotificationTask:Ljava/lang/Runnable;
    .line 230
    const/4 v0, 0
    iput-object v0, p0, Lcom/nom/lib/service/YGNotificationService;->mrequestNotifications:Lcom/nom/lib/ws/request/WSRequest;
    .line 24
    return-void
.end method

.method static synthetic access$0(Lcom/nom/lib/service/YGNotificationService;)V
    .registers 1
    .prologue
    .line 76
    invoke-direct { p0 }, Lcom/nom/lib/service/YGNotificationService;->loadNotifications()V
    return-void
.end method

.method private loadNotifications()V
    .registers 4
    .prologue
    .line 78
    invoke-virtual { p0 }, Lcom/nom/lib/service/YGNotificationService;->getApplication()Landroid/app/Application;
    move-result-object v0
    check-cast v0, Lcom/nom/lib/app/YGApplication;
    .line 79
    .local v0, app:Lcom/nom/lib/app/YGApplication;
    invoke-virtual { v0 }, Lcom/nom/lib/app/YGApplication;->getRequestFactory()Lcom/nom/lib/ws/request/WSRequestFactory;
    move-result-object v1
    .line 80
    .local v1, requestFactory:Lcom/nom/lib/ws/request/WSRequestFactory;
    invoke-virtual { v1, p0 }, Lcom/nom/lib/ws/request/WSRequestFactory;->createRequestGetNotifications(Lcom/nom/lib/ws/request/WSRequest$IWSRequestCallback;)Lcom/nom/lib/ws/request/WSRequest;
    move-result-object v2
    iput-object v2, p0, Lcom/nom/lib/service/YGNotificationService;->mrequestNotifications:Lcom/nom/lib/ws/request/WSRequest;
    .line 81
    iget-object v2, p0, Lcom/nom/lib/service/YGNotificationService;->mrequestNotifications:Lcom/nom/lib/ws/request/WSRequest;
    if-eqz v2, :L0
    .line 83
    iget-object v2, p0, Lcom/nom/lib/service/YGNotificationService;->mrequestNotifications:Lcom/nom/lib/ws/request/WSRequest;
    invoke-virtual { v2 }, Lcom/nom/lib/ws/request/WSRequest;->submit()V
    :L0
    .line 85
    return-void
.end method

.method private onNotificationsLoaded(Lcom/nom/lib/ws/request/WSRequest;)V
    .registers 21
    .prologue
    .line 89
    invoke-virtual/range { p1 .. p1 }, Lcom/nom/lib/ws/request/WSRequest;->getResult()Ljava/lang/Object;
    move-result-object v16
    .line 90
    .local v16, result:Ljava/lang/Object;
    if-eqz v16, :L1
    .line 91
    new-instance v13, Lcom/nom/lib/ws/model/NotificationArray;
    check-cast v16, Lorg/json/JSONArray;
    .end local v16
    move-object v0, v13
    move-object/from16 v1, v16
    invoke-direct { v0, v1 }, Lcom/nom/lib/ws/model/NotificationArray;-><init>(Lorg/json/JSONArray;)V
    .line 93
    .local v13, notificationResult:Lcom/nom/lib/ws/model/NotificationArray;
    invoke-virtual { v13 }, Lcom/nom/lib/ws/model/NotificationArray;->length()I
    move-result v14
    .line 94
    .local v14, numNotifications:I
    const/4 v9, 0
    .line 95
    .local v9, notifObj:Lcom/nom/lib/ws/model/NotificationObject;
    const/4 v12, 0
    .line 97
    .local v12, notification:Lcom/nom/lib/model/YGNotification;
    invoke-virtual/range { p0 .. p0 }, Lcom/nom/lib/service/YGNotificationService;->getApplication()Landroid/app/Application;
    move-result-object v3
    check-cast v3, Lcom/nom/lib/app/YGApplication;
    .line 98
    .local v3, app:Lcom/nom/lib/app/YGApplication;
    invoke-virtual { v3 }, Lcom/nom/lib/app/YGApplication;->getPreferences()Lcom/nom/lib/app/Preferences;
    move-result-object v15
    .line 99
    .local v15, prefs:Lcom/nom/lib/app/Preferences;
    invoke-virtual { v15 }, Lcom/nom/lib/app/Preferences;->getLatestNotificationTime()J
    move-result-wide v5
    .line 100
    .local v5, lastTime:J
    move-wide v7, v5
    .line 101
    .local v7, newLastTime:J
    const-wide/16 v10, 0
    .line 103
    .local v10, notifTime:J
    const/4 v4, 0
    :L0
    .local v4, i:I
    if-lt v4, v14, :L2
    .line 128
    invoke-virtual { v15, v7, v8 }, Lcom/nom/lib/app/Preferences;->setLatestNotificationTime(J)V
    :L1
    .line 131
    .end local v3
    .end local v4
    .end local v5
    .end local v7
    .end local v9
    .end local v10
    .end local v12
    .end local v13
    .end local v14
    .end local v15
    return-void
    :L2
    .line 104
    .restart local v3
    .restart local v4
    .restart local v5
    .restart local v7
    .restart local v9
    .restart local v10
    .restart local v12
    .restart local v13
    .restart local v14
    .restart local v15
    invoke-virtual { v13, v4 }, Lcom/nom/lib/ws/model/NotificationArray;->get(I)Lcom/nom/lib/ws/model/NotificationObject;
    move-result-object v9
    .line 105
    if-eqz v9, :L3
    .line 106
    invoke-virtual { v9 }, Lcom/nom/lib/ws/model/NotificationObject;->getTimeCreated()J
    move-result-wide v10
    .line 108
    cmp-long v17, v10, v5
    if-lez v17, :L3
    .line 110
    new-instance v12, Lcom/nom/lib/model/YGNotification;
    .end local v12
    invoke-direct { v12 }, Lcom/nom/lib/model/YGNotification;-><init>()V
    .line 111
    .restart local v12
    invoke-virtual { v9 }, Lcom/nom/lib/ws/model/NotificationObject;->getId()I
    move-result v17
    move-object v0, v12
    move/from16 v1, v17
    invoke-virtual { v0, v1 }, Lcom/nom/lib/model/YGNotification;->setId(I)V
    .line 112
    invoke-virtual { v9 }, Lcom/nom/lib/ws/model/NotificationObject;->getType()I
    move-result v17
    move-object v0, v12
    move/from16 v1, v17
    invoke-virtual { v0, v1 }, Lcom/nom/lib/model/YGNotification;->setType(I)V
    .line 113
    invoke-virtual { v9 }, Lcom/nom/lib/ws/model/NotificationObject;->getMessage()Ljava/lang/String;
    move-result-object v17
    move-object v0, v12
    move-object/from16 v1, v17
    invoke-virtual { v0, v1 }, Lcom/nom/lib/model/YGNotification;->setMessage(Ljava/lang/String;)V
    .line 114
    invoke-virtual { v9 }, Lcom/nom/lib/ws/model/NotificationObject;->getAppName()Ljava/lang/String;
    move-result-object v17
    move-object v0, v12
    move-object/from16 v1, v17
    invoke-virtual { v0, v1 }, Lcom/nom/lib/model/YGNotification;->setAppName(Ljava/lang/String;)V
    .line 115
    invoke-virtual { v9 }, Lcom/nom/lib/ws/model/NotificationObject;->getAppPackageName()Ljava/lang/String;
    move-result-object v17
    move-object v0, v12
    move-object/from16 v1, v17
    invoke-virtual { v0, v1 }, Lcom/nom/lib/model/YGNotification;->setAppPackageName(Ljava/lang/String;)V
    .line 116
    invoke-virtual { v9 }, Lcom/nom/lib/ws/model/NotificationObject;->getAppActivityName()Ljava/lang/String;
    move-result-object v17
    move-object v0, v12
    move-object/from16 v1, v17
    invoke-virtual { v0, v1 }, Lcom/nom/lib/model/YGNotification;->setAppActivityName(Ljava/lang/String;)V
    .line 117
    invoke-virtual { v9 }, Lcom/nom/lib/ws/model/NotificationObject;->getTimeCreated()J
    move-result-wide v17
    move-object v0, v12
    move-wide/from16 v1, v17
    invoke-virtual { v0, v1, v2 }, Lcom/nom/lib/model/YGNotification;->setCreatedTime(J)V
    .line 118
    invoke-virtual { v9 }, Lcom/nom/lib/ws/model/NotificationObject;->getIconUrl()Ljava/lang/String;
    move-result-object v17
    move-object v0, v12
    move-object/from16 v1, v17
    invoke-virtual { v0, v1 }, Lcom/nom/lib/model/YGNotification;->setIconUrl(Ljava/lang/String;)V
    .line 120
    move-object/from16 v0, p0
    move-object v1, v12
    invoke-direct { v0, v1 }, Lcom/nom/lib/service/YGNotificationService;->showNotification(Lcom/nom/lib/model/YGNotification;)V
    .line 122
    move-wide v7, v10
    :L3
    .line 103
    add-int/lit8 v4, v4, 1
    goto :L0
.end method

.method private resetTaskTimer()V
    .registers 5
    .prologue
    .line 210
    iget-object v0, p0, Lcom/nom/lib/service/YGNotificationService;->mTimerHandler:Landroid/os/Handler;
    iget-object v1, p0, Lcom/nom/lib/service/YGNotificationService;->pollNotificationTask:Ljava/lang/Runnable;
    invoke-virtual { v0, v1 }, Landroid/os/Handler;->removeCallbacks(Ljava/lang/Runnable;)V
    .line 213
    iget-object v0, p0, Lcom/nom/lib/service/YGNotificationService;->mTimerHandler:Landroid/os/Handler;
    iget-object v1, p0, Lcom/nom/lib/service/YGNotificationService;->pollNotificationTask:Ljava/lang/Runnable;
    iget-wide v2, p0, Lcom/nom/lib/service/YGNotificationService;->mPollingInterval:J
    invoke-virtual { v0, v1, v2, v3 }, Landroid/os/Handler;->postDelayed(Ljava/lang/Runnable;J)Z
    .line 214
    return-void
.end method

.method private showNotification(Lcom/nom/lib/model/YGNotification;)V
    .registers 12
    .prologue
    .line 140
    const v4, 2130837555
    .line 142
    .local v4, notifIconId:I
    invoke-virtual { p1 }, Lcom/nom/lib/model/YGNotification;->getCreatedTime()J
    move-result-wide v6
    .line 144
    .local v6, timestamp:J
    new-instance v3, Landroid/app/Notification;
    invoke-virtual { p1 }, Lcom/nom/lib/model/YGNotification;->getMessage()Ljava/lang/String;
    move-result-object v8
    invoke-direct { v3, v4, v8, v6, v7 }, Landroid/app/Notification;-><init>(ILjava/lang/CharSequence;J)V
    .line 147
    .local v3, notif:Landroid/app/Notification;
    new-instance v2, Landroid/content/Intent;
    invoke-direct { v2 }, Landroid/content/Intent;-><init>()V
    .line 148
    .local v2, intentApp:Landroid/content/Intent;
    invoke-virtual { p1 }, Lcom/nom/lib/model/YGNotification;->getAppPackageName()Ljava/lang/String;
    move-result-object v5
    .line 149
    .local v5, packageName:Ljava/lang/String;
    new-instance v8, Ljava/lang/StringBuilder;
    invoke-static { v5 }, Ljava/lang/String;->valueOf(Ljava/lang/Object;)Ljava/lang/String;
    move-result-object v9
    invoke-direct { v8, v9 }, Ljava/lang/StringBuilder;-><init>(Ljava/lang/String;)V
    invoke-virtual { p1 }, Lcom/nom/lib/model/YGNotification;->getAppActivityName()Ljava/lang/String;
    move-result-object v9
    invoke-virtual { v8, v9 }, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
    move-result-object v8
    invoke-virtual { v8 }, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;
    move-result-object v0
    .line 150
    .local v0, activityName:Ljava/lang/String;
    invoke-virtual { v2, v5, v0 }, Landroid/content/Intent;->setClassName(Ljava/lang/String;Ljava/lang/String;)Landroid/content/Intent;
    .line 151
    const-string v8, "NotificationId"
    invoke-virtual { p1 }, Lcom/nom/lib/model/YGNotification;->getType()I
    move-result v9
    invoke-virtual { v2, v8, v9 }, Landroid/content/Intent;->putExtra(Ljava/lang/String;I)Landroid/content/Intent;
    .line 152
    invoke-virtual { p1 }, Lcom/nom/lib/model/YGNotification;->getId()I
    move-result v8
    invoke-static { v8 }, Ljava/lang/String;->valueOf(I)Ljava/lang/String;
    move-result-object v8
    invoke-virtual { v2, v8 }, Landroid/content/Intent;->setType(Ljava/lang/String;)Landroid/content/Intent;
    .line 153
    const/4 v8, 0
    const/high16 v9, 2048
    invoke-static { p0, v8, v2, v9 }, Landroid/app/PendingIntent;->getActivity(Landroid/content/Context;ILandroid/content/Intent;I)Landroid/app/PendingIntent;
    move-result-object v1
    .line 156
    .local v1, contentIntent:Landroid/app/PendingIntent;
    invoke-virtual { p1 }, Lcom/nom/lib/model/YGNotification;->getAppName()Ljava/lang/String;
    move-result-object v8
    invoke-virtual { p1 }, Lcom/nom/lib/model/YGNotification;->getMessage()Ljava/lang/String;
    move-result-object v9
    invoke-virtual { v3, p0, v8, v9, v1 }, Landroid/app/Notification;->setLatestEventInfo(Landroid/content/Context;Ljava/lang/CharSequence;Ljava/lang/CharSequence;Landroid/app/PendingIntent;)V
    .line 160
    iget-object v8, p0, Lcom/nom/lib/service/YGNotificationService;->mmgrNotification:Landroid/app/NotificationManager;
    invoke-virtual { p1 }, Lcom/nom/lib/model/YGNotification;->getType()I
    move-result v9
    invoke-virtual { v8, v9, v3 }, Landroid/app/NotificationManager;->notify(ILandroid/app/Notification;)V
    .line 161
    return-void
.end method

.method private startTaskTimer()V
    .registers 3
    .prologue
    .line 194
    const-wide/32 v0, 86400000
    invoke-direct { p0, v0, v1 }, Lcom/nom/lib/service/YGNotificationService;->startTaskTimer(J)V
    .line 195
    return-void
.end method

.method private startTaskTimer(J)V
    .registers 7
    .prologue
    .line 165
    const-wide/16 v0, 0
    cmp-long v0, p1, v0
    if-lez v0, :L2
    .line 166
    iput-wide p1, p0, Lcom/nom/lib/service/YGNotificationService;->mPollingInterval:J
    :L0
    .line 172
    iget-object v0, p0, Lcom/nom/lib/service/YGNotificationService;->mTimerHandler:Landroid/os/Handler;
    if-nez v0, :L3
    .line 174
    new-instance v0, Landroid/os/Handler;
    invoke-direct { v0 }, Landroid/os/Handler;-><init>()V
    iput-object v0, p0, Lcom/nom/lib/service/YGNotificationService;->mTimerHandler:Landroid/os/Handler;
    .line 177
    iget-object v0, p0, Lcom/nom/lib/service/YGNotificationService;->mTimerHandler:Landroid/os/Handler;
    iget-object v1, p0, Lcom/nom/lib/service/YGNotificationService;->pollNotificationTask:Ljava/lang/Runnable;
    const-wide/16 v2, 10000
    invoke-virtual { v0, v1, v2, v3 }, Landroid/os/Handler;->postDelayed(Ljava/lang/Runnable;J)Z
    :L1
    .line 187
    return-void
    :L2
    .line 169
    const-wide/32 v0, 86400000
    iput-wide v0, p0, Lcom/nom/lib/service/YGNotificationService;->mPollingInterval:J
    goto :L0
    :L3
    .line 183
    iget-object v0, p0, Lcom/nom/lib/service/YGNotificationService;->mTimerHandler:Landroid/os/Handler;
    iget-object v1, p0, Lcom/nom/lib/service/YGNotificationService;->pollNotificationTask:Ljava/lang/Runnable;
    invoke-virtual { v0, v1 }, Landroid/os/Handler;->removeCallbacks(Ljava/lang/Runnable;)V
    .line 186
    iget-object v0, p0, Lcom/nom/lib/service/YGNotificationService;->mTimerHandler:Landroid/os/Handler;
    iget-object v1, p0, Lcom/nom/lib/service/YGNotificationService;->pollNotificationTask:Ljava/lang/Runnable;
    iget-wide v2, p0, Lcom/nom/lib/service/YGNotificationService;->mPollingInterval:J
    invoke-virtual { v0, v1, v2, v3 }, Landroid/os/Handler;->postDelayed(Ljava/lang/Runnable;J)Z
    goto :L1
.end method

.method private stopTaskTimer()V
    .registers 3
    .prologue
    .line 202
    iget-object v0, p0, Lcom/nom/lib/service/YGNotificationService;->mTimerHandler:Landroid/os/Handler;
    if-eqz v0, :L0
    .line 203
    iget-object v0, p0, Lcom/nom/lib/service/YGNotificationService;->mTimerHandler:Landroid/os/Handler;
    iget-object v1, p0, Lcom/nom/lib/service/YGNotificationService;->pollNotificationTask:Ljava/lang/Runnable;
    invoke-virtual { v0, v1 }, Landroid/os/Handler;->removeCallbacks(Ljava/lang/Runnable;)V
    .line 205
    const/4 v0, 0
    iput-object v0, p0, Lcom/nom/lib/service/YGNotificationService;->mTimerHandler:Landroid/os/Handler;
    :L0
    .line 207
    return-void
.end method

.method public onBind(Landroid/content/Intent;)Landroid/os/IBinder;
    .registers 3
    .prologue
    .line 72
    const/4 v0, 0
    return-object v0
.end method

.method public onCreate()V
    .registers 2
    .prologue
    .line 39
    invoke-super { p0 }, Landroid/app/Service;->onCreate()V
    .line 42
    const-string v0, "notification"
    invoke-virtual { p0, v0 }, Lcom/nom/lib/service/YGNotificationService;->getSystemService(Ljava/lang/String;)Ljava/lang/Object;
    move-result-object v0
    check-cast v0, Landroid/app/NotificationManager;
    iput-object v0, p0, Lcom/nom/lib/service/YGNotificationService;->mmgrNotification:Landroid/app/NotificationManager;
    .line 44
    return-void
.end method

.method public onDestroy()V
    .registers 1
    .prologue
    .line 48
    invoke-super { p0 }, Landroid/app/Service;->onDestroy()V
    .line 51
    invoke-direct { p0 }, Lcom/nom/lib/service/YGNotificationService;->stopTaskTimer()V
    .line 52
    return-void
.end method

.method public onStart(Landroid/content/Intent;I)V
    .registers 3
    .prologue
    .line 56
    invoke-super { p0, p1, p2 }, Landroid/app/Service;->onStart(Landroid/content/Intent;I)V
    .line 58
    return-void
.end method

.method public onStartCommand(Landroid/content/Intent;II)I
    .registers 5
    .prologue
    .line 64
    invoke-direct { p0 }, Lcom/nom/lib/service/YGNotificationService;->startTaskTimer()V
    .line 67
    const/4 v0, 1
    return v0
.end method

.method public receivedError(Lcom/nom/lib/ws/request/WSRequest;)V
    .registers 4
    .prologue
    .line 255
    iget-object v1, p0, Lcom/nom/lib/service/YGNotificationService;->mrequestNotifications:Lcom/nom/lib/ws/request/WSRequest;
    if-ne p1, v1, :L0
    .line 256
    invoke-virtual { p1 }, Lcom/nom/lib/ws/request/WSRequest;->getResult()Ljava/lang/Object;
    move-result-object v0
    .line 261
    .local v0, result:Ljava/lang/Object;
    const/4 v1, 0
    iput-object v1, p0, Lcom/nom/lib/service/YGNotificationService;->mrequestNotifications:Lcom/nom/lib/ws/request/WSRequest;
    .line 264
    invoke-direct { p0 }, Lcom/nom/lib/service/YGNotificationService;->resetTaskTimer()V
    :L0
    .line 266
    .end local v0
    return-void
.end method

.method public receivedResponse(Lcom/nom/lib/ws/request/WSRequest;)V
    .registers 3
    .prologue
    .line 239
    iget-object v0, p0, Lcom/nom/lib/service/YGNotificationService;->mrequestNotifications:Lcom/nom/lib/ws/request/WSRequest;
    if-ne p1, v0, :L0
    .line 241
    invoke-direct { p0, p1 }, Lcom/nom/lib/service/YGNotificationService;->onNotificationsLoaded(Lcom/nom/lib/ws/request/WSRequest;)V
    .line 243
    const/4 v0, 0
    iput-object v0, p0, Lcom/nom/lib/service/YGNotificationService;->mrequestNotifications:Lcom/nom/lib/ws/request/WSRequest;
    .line 246
    invoke-direct { p0 }, Lcom/nom/lib/service/YGNotificationService;->resetTaskTimer()V
    :L0
    .line 248
    return-void
.end method
