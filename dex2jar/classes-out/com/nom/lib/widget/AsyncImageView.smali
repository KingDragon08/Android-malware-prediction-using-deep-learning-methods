.class public Lcom/nom/lib/widget/AsyncImageView;
.super Landroid/widget/ImageView;
.implements Lcom/nom/lib/ws/request/WSRequest$IWSRequestCallback;
.source "AsyncImageView.java"

.annotation system Ldalvik/annotation/MemberClasses;
    value = {
        Lcom/nom/lib/widget/AsyncImageView$PostLoadCallback;
    }
.end annotation

.field private imageRequest:Lcom/nom/lib/ws/request/WSRequest;

.field private mApplication:Lcom/nom/lib/app/YGApplication;

.field private mDefaultImage:Landroid/graphics/drawable/Drawable;

.field private mImageUrl:Ljava/lang/String;

.field private mIs9Patch:Z

.field private mNinePatchChunk:[B

.field private mPostLoadCallback:Lcom/nom/lib/widget/AsyncImageView$PostLoadCallback;

.method public constructor <init>(Landroid/content/Context;)V
    .registers 4
    .prologue
    const/4 v1, 0
    .line 31
    invoke-direct { p0, p1 }, Landroid/widget/ImageView;-><init>(Landroid/content/Context;)V
    .line 24
    iput-object v1, p0, Lcom/nom/lib/widget/AsyncImageView;->mDefaultImage:Landroid/graphics/drawable/Drawable;
    .line 27
    iput-object v1, p0, Lcom/nom/lib/widget/AsyncImageView;->mPostLoadCallback:Lcom/nom/lib/widget/AsyncImageView$PostLoadCallback;
    .line 199
    const/4 v0, 0
    iput-boolean v0, p0, Lcom/nom/lib/widget/AsyncImageView;->mIs9Patch:Z
    .line 200
    iput-object v1, p0, Lcom/nom/lib/widget/AsyncImageView;->mNinePatchChunk:[B
    .line 32
    return-void
.end method

.method public constructor <init>(Landroid/content/Context;Landroid/util/AttributeSet;)V
    .registers 5
    .prologue
    const/4 v1, 0
    .line 35
    invoke-direct { p0, p1, p2 }, Landroid/widget/ImageView;-><init>(Landroid/content/Context;Landroid/util/AttributeSet;)V
    .line 24
    iput-object v1, p0, Lcom/nom/lib/widget/AsyncImageView;->mDefaultImage:Landroid/graphics/drawable/Drawable;
    .line 27
    iput-object v1, p0, Lcom/nom/lib/widget/AsyncImageView;->mPostLoadCallback:Lcom/nom/lib/widget/AsyncImageView$PostLoadCallback;
    .line 199
    const/4 v0, 0
    iput-boolean v0, p0, Lcom/nom/lib/widget/AsyncImageView;->mIs9Patch:Z
    .line 200
    iput-object v1, p0, Lcom/nom/lib/widget/AsyncImageView;->mNinePatchChunk:[B
    .line 36
    return-void
.end method

.method public constructor <init>(Landroid/content/Context;Landroid/util/AttributeSet;I)V
    .registers 6
    .prologue
    const/4 v1, 0
    .line 39
    invoke-direct { p0, p1, p2, p3 }, Landroid/widget/ImageView;-><init>(Landroid/content/Context;Landroid/util/AttributeSet;I)V
    .line 24
    iput-object v1, p0, Lcom/nom/lib/widget/AsyncImageView;->mDefaultImage:Landroid/graphics/drawable/Drawable;
    .line 27
    iput-object v1, p0, Lcom/nom/lib/widget/AsyncImageView;->mPostLoadCallback:Lcom/nom/lib/widget/AsyncImageView$PostLoadCallback;
    .line 199
    const/4 v0, 0
    iput-boolean v0, p0, Lcom/nom/lib/widget/AsyncImageView;->mIs9Patch:Z
    .line 200
    iput-object v1, p0, Lcom/nom/lib/widget/AsyncImageView;->mNinePatchChunk:[B
    .line 40
    return-void
.end method

.method private onImageLoaded(Lcom/nom/lib/ws/request/WSRequest;)Z
    .catch Ljava/lang/OutOfMemoryError; { :L3 .. :L6 } :L9
    .catch Ljava/lang/OutOfMemoryError; { :L7 .. :L8 } :L9
    .registers 12
    .prologue
    const/4 v9, 1
    const/4 v8, 0
    .line 149
    iget-object v6, p0, Lcom/nom/lib/widget/AsyncImageView;->imageRequest:Lcom/nom/lib/ws/request/WSRequest;
    invoke-virtual { v6 }, Lcom/nom/lib/ws/request/WSRequest;->getResult()Ljava/lang/Object;
    move-result-object v5
    .line 150
    .local v5, result:Ljava/lang/Object;
    if-nez v5, :L1
    move v6, v8
    :L0
    .line 196
    return v6
    :L1
    .line 154
    iget-object v6, p0, Lcom/nom/lib/widget/AsyncImageView;->mApplication:Lcom/nom/lib/app/YGApplication;
    if-nez v6, :L2
    move v6, v8
    .line 155
    goto :L0
    :L2
    .line 158
    move-object v0, v5
    check-cast v0, [B
    move-object v2, v0
    .line 160
    .local v2, bmData:[B
    const/4 v6, 0
    :L3
    array-length v7, v2
    invoke-static { v2, v6, v7 }, Landroid/graphics/BitmapFactory;->decodeByteArray([BII)Landroid/graphics/Bitmap;
    move-result-object v1
    .line 161
    .local v1, bm:Landroid/graphics/Bitmap;
    if-nez v1, :L4
    move v6, v8
    .line 162
    goto :L0
    :L4
    .line 165
    iget-boolean v6, p0, Lcom/nom/lib/widget/AsyncImageView;->mIs9Patch:Z
    if-eqz v6, :L7
    .line 166
    iget-object v6, p0, Lcom/nom/lib/widget/AsyncImageView;->mNinePatchChunk:[B
    invoke-direct { p0, v1, v6 }, Lcom/nom/lib/widget/AsyncImageView;->setImageNinePatchDrawable(Landroid/graphics/Bitmap;[B)V
    :L5
    .line 172
    invoke-virtual { p0 }, Lcom/nom/lib/widget/AsyncImageView;->invalidate()V
    :L6
    .line 178
    iget-object v6, p0, Lcom/nom/lib/widget/AsyncImageView;->mImageUrl:Ljava/lang/String;
    if-nez v6, :L10
    move v6, v9
    .line 179
    goto :L0
    :L7
    .line 169
    invoke-virtual { p0, v1 }, Lcom/nom/lib/widget/AsyncImageView;->setImageBitmap(Landroid/graphics/Bitmap;)V
    :L8
    goto :L5
    :L9
    .line 174
    .end local v1
    move-exception v6
    move-object v4, v6
    .line 175
    .local v4, e:Ljava/lang/OutOfMemoryError;
    throw v4
    :L10
    .line 183
    .end local v4
    .restart local v1
    iget-object v6, p0, Lcom/nom/lib/widget/AsyncImageView;->mApplication:Lcom/nom/lib/app/YGApplication;
    invoke-virtual { v6 }, Lcom/nom/lib/app/YGApplication;->getImageCache()Lcom/nom/lib/database/ImageCache;
    move-result-object v3
    .line 184
    .local v3, cache:Lcom/nom/lib/database/ImageCache;
    if-nez v3, :L11
    move v6, v9
    .line 185
    goto :L0
    :L11
    .line 189
    iget-object v6, p0, Lcom/nom/lib/widget/AsyncImageView;->mImageUrl:Ljava/lang/String;
    invoke-virtual { v3, v6 }, Lcom/nom/lib/database/ImageCache;->hasKey(Ljava/lang/String;)Z
    move-result v6
    if-eqz v6, :L12
    move v6, v9
    .line 190
    goto :L0
    :L12
    .line 194
    iget-object v6, p0, Lcom/nom/lib/widget/AsyncImageView;->mImageUrl:Ljava/lang/String;
    invoke-virtual { v3, v2, v6, v8 }, Lcom/nom/lib/database/ImageCache;->addItem([BLjava/lang/String;Z)V
    move v6, v9
    .line 196
    goto :L0
.end method

.method private setImageNinePatchDrawable(Landroid/graphics/Bitmap;[B)V
    .registers 6
    .prologue
    .line 218
    new-instance v1, Landroid/graphics/NinePatch;
    const/4 v2, 0
    invoke-direct { v1, p1, p2, v2 }, Landroid/graphics/NinePatch;-><init>(Landroid/graphics/Bitmap;[BLjava/lang/String;)V
    .line 219
    .local v1, ninePatch:Landroid/graphics/NinePatch;
    new-instance v0, Landroid/graphics/drawable/NinePatchDrawable;
    invoke-direct { v0, v1 }, Landroid/graphics/drawable/NinePatchDrawable;-><init>(Landroid/graphics/NinePatch;)V
    .line 221
    .local v0, nineDrawable:Landroid/graphics/drawable/NinePatchDrawable;
    invoke-virtual { p0, v0 }, Lcom/nom/lib/widget/AsyncImageView;->setImageDrawable(Landroid/graphics/drawable/Drawable;)V
    .line 223
    return-void
.end method

.method public enable9Patch(Z[B)V
    .registers 3
    .prologue
    .line 207
    iput-boolean p1, p0, Lcom/nom/lib/widget/AsyncImageView;->mIs9Patch:Z
    .line 208
    iput-object p2, p0, Lcom/nom/lib/widget/AsyncImageView;->mNinePatchChunk:[B
    .line 209
    return-void
.end method

.method public fetch(Ljava/lang/String;Lcom/nom/lib/app/YGApplication;)V
    .registers 8
    .prologue
    .line 63
    if-eqz p1, :L0
    invoke-virtual { p1 }, Ljava/lang/String;->length()I
    move-result v3
    if-lez v3, :L0
    if-nez p2, :L2
    :L0
    .line 64
    iget-object v3, p0, Lcom/nom/lib/widget/AsyncImageView;->mDefaultImage:Landroid/graphics/drawable/Drawable;
    if-eqz v3, :L1
    .line 65
    iget-object v3, p0, Lcom/nom/lib/widget/AsyncImageView;->mDefaultImage:Landroid/graphics/drawable/Drawable;
    invoke-virtual { p0, v3 }, Lcom/nom/lib/widget/AsyncImageView;->setImageDrawable(Landroid/graphics/drawable/Drawable;)V
    :L1
    .line 107
    return-void
    :L2
    .line 70
    iget-object v3, p0, Lcom/nom/lib/widget/AsyncImageView;->imageRequest:Lcom/nom/lib/ws/request/WSRequest;
    if-eqz v3, :L3
    .line 71
    iget-object v3, p0, Lcom/nom/lib/widget/AsyncImageView;->imageRequest:Lcom/nom/lib/ws/request/WSRequest;
    invoke-virtual { v3 }, Lcom/nom/lib/ws/request/WSRequest;->cancel()V
    .line 72
    const/4 v3, 0
    iput-object v3, p0, Lcom/nom/lib/widget/AsyncImageView;->imageRequest:Lcom/nom/lib/ws/request/WSRequest;
    :L3
    .line 75
    iput-object p2, p0, Lcom/nom/lib/widget/AsyncImageView;->mApplication:Lcom/nom/lib/app/YGApplication;
    .line 78
    invoke-virtual { p2 }, Lcom/nom/lib/app/YGApplication;->getImageCache()Lcom/nom/lib/database/ImageCache;
    move-result-object v2
    .line 79
    .local v2, cache:Lcom/nom/lib/database/ImageCache;
    if-eqz v2, :L6
    .line 81
    invoke-virtual { v2, p1 }, Lcom/nom/lib/database/ImageCache;->getItemForKey(Ljava/lang/String;)[B
    move-result-object v1
    .line 83
    .local v1, byteImage:[B
    if-eqz v1, :L6
    array-length v3, v1
    if-lez v3, :L6
    .line 85
    const/4 v3, 0
    array-length v4, v1
    invoke-static { v1, v3, v4 }, Landroid/graphics/BitmapFactory;->decodeByteArray([BII)Landroid/graphics/Bitmap;
    move-result-object v0
    .line 86
    .local v0, bm:Landroid/graphics/Bitmap;
    iget-boolean v3, p0, Lcom/nom/lib/widget/AsyncImageView;->mIs9Patch:Z
    if-eqz v3, :L5
    .line 87
    iget-object v3, p0, Lcom/nom/lib/widget/AsyncImageView;->mNinePatchChunk:[B
    invoke-direct { p0, v0, v3 }, Lcom/nom/lib/widget/AsyncImageView;->setImageNinePatchDrawable(Landroid/graphics/Bitmap;[B)V
    :L4
    .line 94
    iget-object v3, p0, Lcom/nom/lib/widget/AsyncImageView;->mPostLoadCallback:Lcom/nom/lib/widget/AsyncImageView$PostLoadCallback;
    if-eqz v3, :L1
    .line 95
    iget-object v3, p0, Lcom/nom/lib/widget/AsyncImageView;->mPostLoadCallback:Lcom/nom/lib/widget/AsyncImageView$PostLoadCallback;
    const/4 v4, 1
    invoke-interface { v3, p0, v4 }, Lcom/nom/lib/widget/AsyncImageView$PostLoadCallback;->completedLoadImage(Lcom/nom/lib/widget/AsyncImageView;Z)V
    goto :L1
    :L5
    .line 90
    invoke-virtual { p0, v0 }, Lcom/nom/lib/widget/AsyncImageView;->setImageBitmap(Landroid/graphics/Bitmap;)V
    goto :L4
    :L6
    .line 102
    .end local v0
    .end local v1
    invoke-virtual { p2 }, Lcom/nom/lib/app/YGApplication;->getRequestFactory()Lcom/nom/lib/ws/request/WSRequestFactory;
    move-result-object v3
    invoke-virtual { v3, p0, p1 }, Lcom/nom/lib/ws/request/WSRequestFactory;->createRequestGetImage(Lcom/nom/lib/ws/request/WSRequest$IWSRequestCallback;Ljava/lang/String;)Lcom/nom/lib/ws/request/WSRequest;
    move-result-object v3
    iput-object v3, p0, Lcom/nom/lib/widget/AsyncImageView;->imageRequest:Lcom/nom/lib/ws/request/WSRequest;
    .line 103
    iget-object v3, p0, Lcom/nom/lib/widget/AsyncImageView;->imageRequest:Lcom/nom/lib/ws/request/WSRequest;
    if-eqz v3, :L1
    .line 104
    iput-object p1, p0, Lcom/nom/lib/widget/AsyncImageView;->mImageUrl:Ljava/lang/String;
    .line 105
    iget-object v3, p0, Lcom/nom/lib/widget/AsyncImageView;->imageRequest:Lcom/nom/lib/ws/request/WSRequest;
    invoke-virtual { v3 }, Lcom/nom/lib/ws/request/WSRequest;->submit()V
    goto :L1
.end method

.method public receivedError(Lcom/nom/lib/ws/request/WSRequest;)V
    .registers 4
    .prologue
    const/4 v1, 0
    .line 134
    iget-object v0, p0, Lcom/nom/lib/widget/AsyncImageView;->imageRequest:Lcom/nom/lib/ws/request/WSRequest;
    if-ne v0, p1, :L1
    .line 135
    iget-object v0, p0, Lcom/nom/lib/widget/AsyncImageView;->mDefaultImage:Landroid/graphics/drawable/Drawable;
    if-eqz v0, :L0
    .line 136
    iget-object v0, p0, Lcom/nom/lib/widget/AsyncImageView;->mDefaultImage:Landroid/graphics/drawable/Drawable;
    invoke-virtual { p0, v0 }, Lcom/nom/lib/widget/AsyncImageView;->setImageDrawable(Landroid/graphics/drawable/Drawable;)V
    :L0
    .line 138
    iput-object v1, p0, Lcom/nom/lib/widget/AsyncImageView;->imageRequest:Lcom/nom/lib/ws/request/WSRequest;
    .line 139
    iput-object v1, p0, Lcom/nom/lib/widget/AsyncImageView;->mImageUrl:Ljava/lang/String;
    :L1
    .line 143
    iget-object v0, p0, Lcom/nom/lib/widget/AsyncImageView;->mPostLoadCallback:Lcom/nom/lib/widget/AsyncImageView$PostLoadCallback;
    if-eqz v0, :L2
    .line 144
    iget-object v0, p0, Lcom/nom/lib/widget/AsyncImageView;->mPostLoadCallback:Lcom/nom/lib/widget/AsyncImageView$PostLoadCallback;
    const/4 v1, 0
    invoke-interface { v0, p0, v1 }, Lcom/nom/lib/widget/AsyncImageView$PostLoadCallback;->completedLoadImage(Lcom/nom/lib/widget/AsyncImageView;Z)V
    :L2
    .line 146
    return-void
.end method

.method public receivedResponse(Lcom/nom/lib/ws/request/WSRequest;)V
    .registers 4
    .prologue
    const/4 v1, 0
    .line 115
    iget-object v0, p0, Lcom/nom/lib/widget/AsyncImageView;->imageRequest:Lcom/nom/lib/ws/request/WSRequest;
    if-ne p1, v0, :L1
    .line 116
    invoke-direct { p0, p1 }, Lcom/nom/lib/widget/AsyncImageView;->onImageLoaded(Lcom/nom/lib/ws/request/WSRequest;)Z
    move-result v0
    if-nez v0, :L0
    iget-object v0, p0, Lcom/nom/lib/widget/AsyncImageView;->mDefaultImage:Landroid/graphics/drawable/Drawable;
    if-eqz v0, :L0
    .line 117
    iget-object v0, p0, Lcom/nom/lib/widget/AsyncImageView;->mDefaultImage:Landroid/graphics/drawable/Drawable;
    invoke-virtual { p0, v0 }, Lcom/nom/lib/widget/AsyncImageView;->setImageDrawable(Landroid/graphics/drawable/Drawable;)V
    :L0
    .line 119
    iput-object v1, p0, Lcom/nom/lib/widget/AsyncImageView;->imageRequest:Lcom/nom/lib/ws/request/WSRequest;
    .line 120
    iput-object v1, p0, Lcom/nom/lib/widget/AsyncImageView;->mImageUrl:Ljava/lang/String;
    :L1
    .line 124
    iget-object v0, p0, Lcom/nom/lib/widget/AsyncImageView;->mPostLoadCallback:Lcom/nom/lib/widget/AsyncImageView$PostLoadCallback;
    if-eqz v0, :L2
    .line 125
    iget-object v0, p0, Lcom/nom/lib/widget/AsyncImageView;->mPostLoadCallback:Lcom/nom/lib/widget/AsyncImageView$PostLoadCallback;
    const/4 v1, 1
    invoke-interface { v0, p0, v1 }, Lcom/nom/lib/widget/AsyncImageView$PostLoadCallback;->completedLoadImage(Lcom/nom/lib/widget/AsyncImageView;Z)V
    :L2
    .line 127
    return-void
.end method

.method public registerPostFetchCallback(Lcom/nom/lib/widget/AsyncImageView$PostLoadCallback;)V
    .registers 2
    .prologue
    .line 51
    iput-object p1, p0, Lcom/nom/lib/widget/AsyncImageView;->mPostLoadCallback:Lcom/nom/lib/widget/AsyncImageView$PostLoadCallback;
    .line 52
    return-void
.end method

.method public setDefaultImage(I)V
    .registers 3
    .prologue
    .line 46
    invoke-virtual { p0 }, Lcom/nom/lib/widget/AsyncImageView;->getResources()Landroid/content/res/Resources;
    move-result-object v0
    invoke-virtual { v0, p1 }, Landroid/content/res/Resources;->getDrawable(I)Landroid/graphics/drawable/Drawable;
    move-result-object v0
    iput-object v0, p0, Lcom/nom/lib/widget/AsyncImageView;->mDefaultImage:Landroid/graphics/drawable/Drawable;
    .line 47
    return-void
.end method

.method public unregisterPostFetchCallback(Lcom/nom/lib/widget/AsyncImageView$PostLoadCallback;)V
    .registers 3
    .prologue
    .line 56
    const/4 v0, 0
    iput-object v0, p0, Lcom/nom/lib/widget/AsyncImageView;->mPostLoadCallback:Lcom/nom/lib/widget/AsyncImageView$PostLoadCallback;
    .line 57
    return-void
.end method
